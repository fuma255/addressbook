<?php    session_start();    require_once("config.php");    require_once("mysql.php");    if (!isset($_SESSION['no']))    {        header("Location: login.html");        exit(0);    }        $no = $_SESSION['no'];    $city = null;    $sex = null;    $phone = null;    $qq = null;    $email = null;    $work = null;    $comment = null;    if (isset($_POST["r_city"]))    {        $city = $_POST["r_city"];        $city = htmlspecialchars(stripslashes($city));    }    if (isset($_POST["r_sex"]))    {        $sex = $_POST["r_sex"];    }    if (isset($_POST["r_phone"]))    {        $phone = $_POST["r_phone"];    }    if (isset($_POST["r_qq"]))    {        $qq = $_POST["r_qq"];    }    if (isset($_POST["r_email"]))    {        $email = $_POST["r_email"];    }    if (isset($_POST["r_work"]))    {        $work = $_POST["r_work"];        $work = htmlspecialchars(stripslashes($work));    }    if (isset($_POST["r_comment"]))    {        $comment = $_POST["r_comment"];        $search = array ("'<script[^>]*?>.*?</script>'si",  // 去掉 javascript                     "'<[\/\!]*?[^<>]*?>'si",           // 去掉 HTML 标记                     "'([\r\n])[\s]+'",                 // 去掉空白字符                     "'&(quot|#34);'i",                 // 替换 HTML 实体                     "'&(amp|#38);'i",                     "'&(lt|#60);'i",                     "'&(gt|#62);'i",                     "'&(nbsp|#160);'i",                     "'&(iexcl|#161);'i",                     "'&(cent|#162);'i",                     "'&(pound|#163);'i",                     "'&(copy|#169);'i",                     "'&#(\d+);'e");                    // 作为 PHP 代码运行        $replace = array ("",                          "",                          "\\1",                          "\"",                          "&",                          "<",                          ">",                          " ",                          chr(161),                          chr(162),                          chr(163),                          chr(169),                          "chr(\\1)");        $comment = preg_replace ($search, $replace, $comment);        //$comment = preg_replace("'([\r\n])[\s]+'", "", $comment);        $comment = str_replace(array("\r\n", "\r", "\n"), "", $comment);    }    global $db;    $dboperator = new MysqlOperator($db["name"],$db["user"],$db["password"],$db["database"],'pconn', 'UTF8');    // 检测是否已经注册过账号    $sql = "update info set sex='$sex',city='$city',phone='$phone',qq='$qq',email='$email',work='$work',            comment='$comment' where no='$no'";    $result = $dboperator->query($sql);    if ($result != null)    {        echo "<script language='javascript'>window.location.href='edit_success.html'</script>";    }    else    {        echo "<script language='javascript'>window.location.href='edit_error.html'</script>";    }    ?>